# Generating an Auth0 Test Token

This document describes how to generate a test token from Auth0 to authenticate with the virtual staging API.

## Prerequisites

- An Auth0 account. You can create one for free at [https://auth0.com/](https://auth0.com/).

## Step-by-Step Guide

### 1. Create an API in Auth0

1.  Log in to your Auth0 dashboard.
2.  Navigate to **Applications > APIs**.
3.  Click **+ Create API**.
4.  Provide the following information:
    - **Name:** A descriptive name for your API (e.g., "Virtual Staging API").
    - **Identifier:** `https://api.virtualstaging.local`. This is the `audience` the server will expect.
    - **Signing Algorithm:** Keep the default `RS256`.
5.  Click **Create**.

#### Implementation Details

| Name                 | Identifier                                       | Signing Algorithm |
| -------------------- | ------------------------------------------------ | ----------------- |
| Auth0 Management API | https://dev-sleeping-pandas.us.auth0.com/api/v2/ | RS256             |
| Virtual Staging API  | https://api.virtualstaging.local                 | RS256             |

#### Test Settings

These are test instructions generated by Auth0:

**Asking Auth0 for tokens from my application**

Send test payload with Go (use environment variables; never hardcode secrets)

```go
package main

import (
  "bytes"
  "encoding/json"
  "fmt"
  "io"
  "net/http"
  "os"
)

func main() {
  domain := os.Getenv("AUTH0_DOMAIN") // e.g. dev-xxxx.us.auth0.com
  url := fmt.Sprintf("https://%s/oauth/token", domain)

  payload := map[string]string{
    "client_id":     os.Getenv("AUTH0_CLIENT_ID"),
    "client_secret": os.Getenv("AUTH0_CLIENT_SECRET"),
    "audience":      os.Getenv("AUTH0_AUDIENCE"),
    "grant_type":    "client_credentials",
  }
  b, _ := json.Marshal(payload)

  req, _ := http.NewRequest("POST", url, bytes.NewBuffer(b))
  req.Header.Set("content-type", "application/json")

  res, _ := http.DefaultClient.Do(req)
  defer res.Body.Close()
  io.Copy(os.Stdout, res.Body)
}
```

In this example, values are read from env vars (`AUTH0_CLIENT_ID`, `AUTH0_CLIENT_SECRET`, `AUTH0_AUDIENCE`, `AUTH0_DOMAIN`). Do not commit secrets.

Sample response omitted.

**Sending the token to the API**

You can use the `bearer` token with an `Authorization` header to reach your API.

```go
package main

import (
  "net/http"
)

func main() {

  url := "http://localhost:8080/api/v1/projects"

  req, _ := http.NewRequest("GET", url, nil)

  req.Header.Add("authorization", "Bearer YOUR_TOKEN")

  res, _ := http.DefaultClient.Do(req)

}
```

### 2. Create a Single Page Application (SPA)

1.  Navigate to **Applications > Applications**.
2.  Click **+ Create Application**.
3.  Provide the following information:
    - **Name:** A name for your application (e.g., "Virtual Staging Web App").
    - **Application Type:** Select **Single Page Web Applications**.
4.  Click **Create**.

### 3. Get the Test Token

1.  Go back to **Applications > APIs** and select the API you created earlier.
2.  Click on the **Test** tab.
3.  In the **Ask Auth0 for a token** section, you will find a ready-to-use test token.
4.  Click the copy icon to copy the token to your clipboard.

## Using the Token

When making requests to the API, include the token in the `Authorization` header as a Bearer token.

**Example using `curl`:**

```bash
curl -X GET http://localhost:8080/api/v1/projects \
  -H "Authorization: Bearer YOUR_AUTH0_TOKEN"
```

Replace `YOUR_AUTH0_TOKEN` with the token you obtained from the Auth0 dashboard.

## Alternative: Auth0 CLI

For a more streamlined workflow, you can use the Auth0 CLI.

1.  **Install the Auth0 CLI:** Follow the official installation guide at [https://auth0.com/docs/cli](https://auth0.com/docs/cli).
2.  **Log in:**
    ```bash
    auth0 login
    ```
3.  **Get a test token:**
    ```bash
    auth0 test token --audience https://api.virtualstaging.local
    ```

This command will provide you with a test token that you can use for your API requests.

## Notes

- Do not hardcode or commit secrets/tokens. Use environment variables.
- Treat any previously committed secrets as compromised and rotate immediately.
