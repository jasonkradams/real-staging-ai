# Repository Guidelines

This document orients contributors to Virtual Staging AIâ€™s codebase and workflows. Keep changes small, tested, and clearly documented.

## Project Structure & Module Organization
- `apps/api`: Go HTTP API (Echo), domain packages under `internal/<domain>` (e.g., `internal/project`, `internal/image`, `internal/http`). Integration tests live in `apps/api/tests/integration`.
- `apps/worker`: Go background worker that processes image jobs.
- `infra/migrations`: SQL schema migrations (up/down files).
- `web/api/v1`: OpenAPI spec (`oas3.yaml`) and docs.
- `docs`: Architecture, configuration, and developer guides.

## Build, Test, and Development Commands
- `make up` / `make down`: Start/stop dev stack (API, worker, DB, etc.) via Docker Compose.
- `make test` / `make test-cover`: Run unit tests (per module) with optional coverage HTML.
- `make test-integration`: Bring up dockerized deps and run integration tests.
- `make lint` / `make lint-fix`: Run golangci-lint (in Docker) and optionally apply fixes.
- `make generate`: Run code generation (sqlc, mocks via `go generate`).
- `make migrate`, `make migrate-*(up|down)`: Apply migrations to dev or test DBs.
- `make token`: Print an Auth0 access token for local testing.

## Coding Style & Naming Conventions
- Language: Go 1.22+; format with `gofmt` and lint with `golangci-lint`.
- Packages: lower-case, short names; place domain logic in `internal/<domain>`.
- Files: tests end with `*_test.go`; mocks end with `_mock.go` (auto-generated).
- SQL-to-Go: generated by `sqlc` per `apps/api/sqlc.yaml`.

## Testing Guidelines
- Framework: standard `go test` with tags. Unit tests live alongside code; integration tests in `apps/api/tests/integration`.
- Commands: `make test` (fast), `make test-integration` (dockerized Postgres/Redis/S3), `make test-cover` (coverage report).
- Conventions: functions `TestXxx(t *testing.T)`; prefer table-driven tests; keep external calls mocked except in integration suites.

## Commit & Pull Request Guidelines
- Commits: follow Conventional Commits (e.g., `feat(api): add presign upload endpoint`).
- PRs: include purpose, linked issues, test plan/output, and screenshots/logs when relevant. Ensure `make test` and `make lint` pass. Touch docs when changing behavior (see `docs/`).

## Security & Configuration Tips
- Do not commit secrets. Use `.env` for local values loaded by Docker Compose. See `docs/configuration.md`.
- S3/Stripe/Auth0 configs are required to run end-to-end; for local testing, the stack uses test containers and LocalStack/MinIO where applicable.

