openapi: 3.1.0
info:
  title: Real Staging AI API
  description: |
    API for the Real Staging AI application.
    
    ## Authentication
    
    This API uses **OAuth 2.0 / OpenID Connect** via Auth0 for authentication.
    All protected endpoints require a valid JWT access token in the `Authorization` header.
    
    ### Obtaining an Access Token
    
    **For Web Applications:**
    - Use the Auth0 Next.js SDK (`@auth0/nextjs-auth0`)
    - Tokens are automatically managed via encrypted session cookies
    - Access tokens obtained from `/auth/access-token` endpoint
    
    **For Testing:**
    - Use the `make token` command to generate a test token
    - Or authenticate via Auth0 Universal Login in the web UI
    
    ### Token Format
    
    Access tokens are JWTs signed by Auth0 with the following claims:
    - `iss`: Auth0 domain (e.g., `https://dev-sleeping-pandas.us.auth0.com/`)
    - `sub`: User ID (e.g., `auth0|123456789`)
    - `aud`: API audience (e.g., `https://api.realstaging.local`)
    - `exp`: Expiration timestamp
    - `iat`: Issued at timestamp
    - `scope`: OAuth scopes (e.g., `openid profile email`)
    
    ### Using the Access Token
    
    Include the token in the `Authorization` header:
    ```
    Authorization: Bearer <access_token>
    ```
    
    **Note:** The `/api/v1/events` SSE endpoint also accepts tokens via the `access_token` query parameter
    since EventSource doesn't support custom headers.
    
    ## Rate Limiting
    
    Rate limits may apply to prevent abuse. Check response headers for limit information.
    
    ## Versioning
    
    This API is versioned via the URL path (`/api/v1/`). Breaking changes will result in a new version.
  version: 0.1.0
servers:
  - url: http://localhost:8080
    description: Local development server
  - url: https://api.realstaging.ai
    description: Production server
paths:
  /api/v1/projects:
    get:
      summary: Get all projects for the authenticated user
      description:
        Retrieve a list of all projects belonging to the authenticated
        user
      tags:
        - Projects
      security:
        - bearerAuth: []
      responses:
        "200":
          description: A list of projects
          content:
            application/json:
              schema:
                type: object
                properties:
                  projects:
                    type: array
                    items:
                      $ref: "#/components/schemas/Project"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "500":
          $ref: "#/components/responses/InternalServerError"
    post:
      summary: Create a new project
      description: Create a new project for the authenticated user
      tags:
        - Projects
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateProjectRequest"
      responses:
        "201":
          description: The created project
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "422":
          $ref: "#/components/responses/ValidationError"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /api/v1/projects/{id}:
    get:
      summary: Get a project by ID
      description:
        Retrieve a specific project by its ID. The project must belong
        to the authenticated user.
      tags:
        - Projects
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the project
          schema:
            type: string
            format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        "200":
          description: The project
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
        "500":
          $ref: "#/components/responses/InternalServerError"
    put:
      summary: Update a project
      description:
        Update an existing project. The project must belong to the authenticated
        user.
      tags:
        - Projects
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the project
          schema:
            type: string
            format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProjectRequest"
      responses:
        "200":
          description: The updated project
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
        "422":
          $ref: "#/components/responses/ValidationError"
        "500":
          $ref: "#/components/responses/InternalServerError"
    delete:
      summary: Delete a project
      description:
        Delete a project and all associated data. The project must belong
        to the authenticated user.
      tags:
        - Projects
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the project
          schema:
            type: string
            format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        "204":
          description: Project successfully deleted
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /api/v1/uploads/presign:
    post:
      summary: Generate presigned URL for file upload
      description: Generate a presigned URL that allows direct upload to S3 storage
      tags:
        - Uploads
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PresignUploadRequest"
      responses:
        "200":
          description: Presigned upload URL generated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PresignUploadResponse"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "422":
          $ref: "#/components/responses/ValidationError"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /api/v1/images:
    post:
      summary: Add an image to a project
      description: Add a new image to a project.
      tags:
        - Images
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateImageRequest"
      responses:
        "201":
          description: The created image
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Image"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /api/v1/images/batch:
    post:
      summary: Batch create multiple images
      description: |
        Create multiple images in a single request. Each image is processed independently,
        allowing for partial success. Useful for uploading entire properties at once.
        
        **Limits**: 1-50 images per request
        
        **Response Codes**:
        - 201: All images created successfully
        - 207: Partial success (some succeeded, some failed)
        - 400: All images failed
        - 422: Validation errors
      tags:
        - Images
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BatchCreateImagesRequest"
            example:
              images:
                - project_id: "550e8400-e29b-41d4-a716-446655440000"
                  original_url: "https://s3.amazonaws.com/bucket/uploads/user123/image1.jpg"
                  room_type: "living_room"
                  style: "modern"
                - project_id: "550e8400-e29b-41d4-a716-446655440000"
                  original_url: "https://s3.amazonaws.com/bucket/uploads/user123/image2.jpg"
                  room_type: "bedroom"
                - project_id: "550e8400-e29b-41d4-a716-446655440000"
                  original_url: "https://s3.amazonaws.com/bucket/uploads/user123/image3.jpg"
      responses:
        "201":
          description: All images created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BatchCreateImagesResponse"
              example:
                images:
                  - id: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
                    project_id: "550e8400-e29b-41d4-a716-446655440000"
                    original_url: "https://s3.amazonaws.com/bucket/uploads/user123/image1.jpg"
                    status: "queued"
                    room_type: "living_room"
                    style: "modern"
                    created_at: "2025-01-15T10:30:00Z"
                    updated_at: "2025-01-15T10:30:00Z"
                errors: []
                success: 3
                failed: 0
        "207":
          description: Partial success - some images created, some failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BatchCreateImagesResponse"
              example:
                images:
                  - id: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
                    project_id: "550e8400-e29b-41d4-a716-446655440000"
                    original_url: "https://s3.amazonaws.com/bucket/uploads/user123/image1.jpg"
                    status: "queued"
                errors:
                  - index: 1
                    message: "failed to create image: invalid project ID"
                  - index: 2
                    message: "failed to create image: original_url is required"
                success: 1
                failed: 2
        "400":
          description: All images failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BatchCreateImagesResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "422":
          $ref: "#/components/responses/ValidationError"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /api/v1/images/{id}:
    get:
      summary: Get an image by ID
      description:
        Retrieve a specific image by its ID. The image must belong to the
        authenticated user.
      tags:
        - Images
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the image
          schema:
            type: string
            format: uuid
          example: a1b2c3d4-e5f6-7890-1234-567890abcdef
      responses:
        "200":
          description: The image
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Image"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
        "500":
          $ref: "#/components/responses/InternalServerError"
    delete:
      summary: Delete an image
      description: Delete an image. The image must belong to the authenticated user.
      tags:
        - Images
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the image
          schema:
            type: string
            format: uuid
          example: a1b2c3d4-e5f6-7890-1234-567890abcdef
      responses:
        "204":
          description: Image successfully deleted
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /api/v1/projects/{project_id}/images:
    get:
      summary: Get all images for a project
      description: Retrieve a list of images associated with a specific project.
      tags:
        - Images
      security:
        - bearerAuth: []
      parameters:
        - name: project_id
          in: path
          required: true
          description: The unique identifier of the project
          schema:
            type: string
            format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        "200":
          description: A list of images
          content:
            application/json:
              schema:
                type: object
                properties:
                  images:
                    type: array
                    items:
                      $ref: "#/components/schemas/Image"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /api/v1/events:
    get:
      summary: Server-Sent Events for real-time updates
      description: |
        Stream job and image status updates for the authenticated user via Server-Sent Events (SSE).
        
        **Authentication:** This endpoint supports two authentication methods:
        1. Standard `Authorization: Bearer <token>` header (recommended)
        2. Query parameter `access_token=<token>` (for EventSource compatibility)
        
        The query parameter method exists because the browser EventSource API doesn't support
        custom headers. Web applications should fetch the access token from `/auth/access-token`
        and append it to the URL.
        
        **Event Types:**
        - `connected`: Initial connection confirmation
        - `heartbeat`: Keep-alive ping (every 30 seconds)
        - `job_update`: Image processing status update
        
        **Example Usage:**
        ```javascript
        const response = await fetch('/auth/access-token');
        const { accessToken } = await response.json();
        const url = `/api/v1/events?image_id=${imageId}&access_token=${accessToken}`;
        const eventSource = new EventSource(url);
        
        eventSource.addEventListener('job_update', (event) => {
          const data = JSON.parse(event.data);
          console.log('Status:', data.status);
        });
        ```
      tags:
        - Events
      security:
        - bearerAuth: []
        - queryToken: []
      parameters:
        - name: image_id
          in: query
          required: true
          description: The image identifier to subscribe to
          schema:
            type: string
            format: uuid
          example: a1b2c3d4-e5f6-7890-1234-567890abcdef
        - name: access_token
          in: query
          required: false
          description: |
            Access token for authentication (alternative to Authorization header).
            Use this when the client (e.g., EventSource) cannot set custom headers.
          schema:
            type: string
      responses:
        "200":
          description: Event stream established
          content:
            text/event-stream:
              schema:
                type: string
                example: |
                  event: connected
                  data: {"message":"Connected to image stream"}

                  event: heartbeat
                  data: {"timestamp":1700000000}

                  event: job_update
                  data: {"status":"processing"}
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          description: Pub/Sub not configured or unavailable
  /health:
    get:
      summary: Health check endpoint
      description: Returns status of the API service.
      tags:
        - Health
      responses:
        "200":
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  service:
                    type: string
                    example: real-staging-api
  /api/v1/images/{id}/presign:
    get:
      summary: Generate presigned download URL for an image
      description: Returns a browser-accessible presigned URL for the image's original or staged file.
      tags:
        - Images
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the image
          schema:
            type: string
            format: uuid
        - name: kind
          in: query
          required: false
          description: Which file to presign
          schema:
            type: string
            enum: [original, staged]
            default: original
        - name: expires_in
          in: query
          required: false
          description: URL expiration in seconds (default 600)
          schema:
            type: integer
        - name: download
          in: query
          required: false
          description: Set to 1 to force Content-Disposition=attachment
          schema:
            type: integer
            enum: [0, 1]
      responses:
        "200":
          description: Presigned URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/NotFoundError"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /api/v1/stripe/webhook:
    post:
      summary: Stripe webhook endpoint
      description: Receives Stripe events. Verifies signature and processes events idempotently.
      tags:
        - Stripe
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Event received
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: received
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "503":
          description: Webhook secret not configured
  /api/v1/billing/subscriptions:
    get:
      summary: List current user's subscriptions
      description: Retrieve all subscriptions associated with the authenticated user.
      tags:
        - Billing
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          description: Maximum number of subscriptions to return
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Number of subscriptions to skip
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        "200":
          description: A list of subscriptions
          content:
            application/json:
              schema:
                type: object
                properties:
                  subscriptions:
                    type: array
                    items:
                      $ref: "#/components/schemas/Subscription"
                  limit:
                    type: integer
                  offset:
                    type: integer
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /api/v1/billing/invoices:
    get:
      summary: List current user's invoices
      description: Retrieve all invoices associated with the authenticated user.
      tags:
        - Billing
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          description: Maximum number of invoices to return
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Number of invoices to skip
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        "200":
          description: A list of invoices
          content:
            application/json:
              schema:
                type: object
                properties:
                  invoices:
                    type: array
                    items:
                      $ref: "#/components/schemas/Invoice"
                  limit:
                    type: integer
                  offset:
                    type: integer
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /api/v1/user/profile:
    get:
      summary: Get authenticated user's profile
      description: |
        Retrieve the complete profile for the authenticated user.
        
        **Auto-creation behavior:** If the user doesn't exist in the database yet
        (first API access), a new user record will be automatically created with
        default values and returned.
        
        **Profile fields include:**
        - Personal information (email, full name, phone)
        - Business information (company name, billing address)
        - User preferences (notifications, default staging settings)
        - Account metadata (role, Stripe customer ID, timestamps)
      tags:
        - User Profile
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
              example:
                id: "550e8400-e29b-41d4-a716-446655440000"
                email: "john.doe@example.com"
                full_name: "John Doe"
                company_name: "Acme Real Estate"
                phone: "+1 (555) 123-4567"
                billing_address:
                  line1: "123 Main St"
                  line2: "Suite 100"
                  city: "San Francisco"
                  state: "CA"
                  postal_code: "94102"
                  country: "US"
                profile_photo_url: "https://example.com/photos/johndoe.jpg"
                preferences:
                  email_notifications: true
                  marketing_emails: false
                  default_room_type: "living_room"
                  default_style: "modern"
                role: "user"
                stripe_customer_id: "cus_ABC123"
                created_at: "2025-01-15T10:30:00Z"
                updated_at: "2025-01-15T14:22:00Z"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "500":
          $ref: "#/components/responses/InternalServerError"
    patch:
      summary: Update authenticated user's profile
      description: |
        Update the profile for the authenticated user. All fields are optional,
        allowing partial updates.
        
        **Auto-creation behavior:** If the user doesn't exist in the database yet,
        a new user record will be automatically created before applying the updates.
        
        **Validation rules:**
        - `email`: 3-255 characters
        - `full_name`: 1-100 characters
        - `company_name`: 1-100 characters
        - `phone`: 1-20 characters
        - `billing_address`: Valid JSON structure (no nested validation)
        - `preferences`: Valid JSON structure (no nested validation)
        
        **Note:** Only fields provided in the request will be updated. Omitted
        fields will retain their current values.
      tags:
        - User Profile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserProfileRequest"
            examples:
              full_update:
                summary: Update all fields
                value:
                  email: "newemail@example.com"
                  full_name: "Jane Smith"
                  company_name: "Smith Realty"
                  phone: "+1 (555) 987-6543"
                  billing_address:
                    line1: "456 Oak Ave"
                    city: "Portland"
                    state: "OR"
                    postal_code: "97201"
                    country: "US"
                  preferences:
                    email_notifications: true
                    marketing_emails: true
                    default_room_type: "bedroom"
                    default_style: "contemporary"
                  profile_photo_url: "https://example.com/photos/janesmith.jpg"
              partial_update:
                summary: Update only name and phone
                value:
                  full_name: "Jane Doe-Smith"
                  phone: "+1 (555) 111-2222"
              preferences_only:
                summary: Update only preferences
                value:
                  preferences:
                    email_notifications: false
                    default_style: "scandinavian"
      responses:
        "200":
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
        "400":
          description: Invalid request body or malformed JSON
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                error: "bad_request"
                message: "Invalid request body"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "500":
          description: |
            Failed to update profile. Common causes:
            - Validation error (email too short, phone too long, etc.)
            - Database error
            - Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                validation_error:
                  summary: Validation failed
                  value:
                    error: "validation_error"
                    message: "Failed to update profile: email must be at least 3 characters"
                database_error:
                  summary: Database error
                  value:
                    error: "internal_server_error"
                    message: "Failed to update profile"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT access token issued by Auth0.
        
        **How to obtain:**
        - Web app: Use Auth0 SDK, fetch from `/auth/access-token` endpoint
        - Testing: Run `make token` command
        - Direct: Authenticate via Auth0 Universal Login
        
        **Token claims:**
        - `sub`: User ID (used to identify the authenticated user)
        - `aud`: Must match `https://api.realstaging.local`
        - `iss`: Auth0 domain
        - `exp`: Expiration (tokens typically valid for 1 hour)
        
        **Usage:**
        ```
        Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
        ```
    queryToken:
      type: apiKey
      in: query
      name: access_token
      description: |
        Alternative authentication method using query parameter.
        Only supported for `/api/v1/events` SSE endpoint due to EventSource limitations.
        
        **Usage:**
        ```
        GET /api/v1/events?image_id=<uuid>&access_token=<token>
        ```
  responses:
    UnauthorizedError:
      description: |
        Authentication is required to access this resource.
        
        **Common causes:**
        - Missing `Authorization` header
        - Invalid or expired JWT token
        - Token not signed by Auth0
        - Token audience doesn't match API audience
        - User doesn't have permission to access resource
        
        **Resolution:**
        - Ensure you're sending `Authorization: Bearer <token>` header
        - Verify token is not expired (check `exp` claim)
        - Obtain a fresh token if needed
        - For SSE endpoint: check `access_token` query parameter
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            error: unauthorized
            message: "Authentication required"
    BadRequestError:
      description: The request could not be understood due to malformed syntax
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    NotFoundError:
      description: The requested resource was not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    ValidationError:
      description: The request validation failed
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ValidationError"
    InternalServerError:
      description: The server encountered an unexpected condition
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          example: bad_request
        message:
          type: string
          example: Invalid request format
    ValidationError:
      type: object
      properties:
        error:
          type: string
          example: validation_error
        message:
          type: string
          example: One or more fields failed validation
        validation_errors:
          type: array
          items:
            $ref: "#/components/schemas/ValidationErrorDetail"
    ValidationErrorDetail:
      type: object
      properties:
        field:
          type: string
          example: name
        message:
          type: string
          example: must not be empty
    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        user_id:
          type: string
          example: auth0|123456789
        name:
          type: string
          example: Living Room Staging
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    CreateProjectRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          example: New Project
    UpdateProjectRequest:
      type: object
      properties:
        name:
          type: string
          example: Updated Project Name
    Image:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: a1b2c3d4-e5f6-7890-1234-567890abcdef
        project_id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        original_url:
          type: string
          example: https://s3.amazonaws.com/bucket/original.jpg
        staged_url:
          type: string
          example: https://s3.amazonaws.com/bucket/staged.jpg
        room_type:
          type: string
          example: living_room
        style:
          type: string
          example: modern
        seed:
          type: integer
          format: int64
          example: 123
        status:
          type: string
          enum: [queued, processing, ready, error]
          example: ready
        error:
          type: string
          example: failed to process image
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    CreateImageRequest:
      type: object
      required:
        - project_id
        - original_url
      properties:
        project_id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        original_url:
          type: string
          example: https://s3.amazonaws.com/bucket/original.jpg
        room_type:
          type: string
          example: living_room
        style:
          type: string
          example: modern
        seed:
          type: integer
          format: int64
    BatchCreateImagesRequest:
      type: object
      required:
        - images
      properties:
        images:
          type: array
          minItems: 1
          maxItems: 50
          items:
            $ref: "#/components/schemas/CreateImageRequest"
          description: Array of images to create (1-50 images)
    BatchCreateImagesResponse:
      type: object
      properties:
        images:
          type: array
          items:
            $ref: "#/components/schemas/Image"
          description: Successfully created images
        errors:
          type: array
          items:
            $ref: "#/components/schemas/BatchImageError"
          description: Errors for failed image creations
        success:
          type: integer
          description: Number of successfully created images
          example: 8
        failed:
          type: integer
          description: Number of failed image creations
          example: 2
    BatchImageError:
      type: object
      properties:
        index:
          type: integer
          description: Zero-based index of the failed image in the request array
          example: 3
        message:
          type: string
          description: Error message describing why the image creation failed
          example: "failed to create image: invalid project ID"
    PresignUploadRequest:
      type: object
      required:
        - filename
        - content_type
        - file_size
      properties:
        filename:
          type: string
          example: photo.jpg
        content_type:
          type: string
          example: image/jpeg
        file_size:
          type: integer
          format: int64
          example: 1048576
    PresignUploadResponse:
      type: object
      properties:
        upload_url:
          type: string
          example: https://s3.amazonaws.com/presigned-put-url
        file_key:
          type: string
          example: uploads/user-123/photo-uuid.jpg
        expires_in:
          type: integer
          example: 900
    Subscription:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
        plan:
          type: string
          example: pro
        status:
          type: string
          example: active
        started_at:
          type: string
          format: date-time
        current_period_end:
          type: string
          format: date-time
    Invoice:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
        amount_due:
          type: number
          format: float
          example: 49.99
        currency:
          type: string
          example: USD
        status:
          type: string
          example: paid
        due_date:
          type: string
          format: date-time
    UserProfile:
      type: object
      required:
        - id
        - role
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the user
          example: "550e8400-e29b-41d4-a716-446655440000"
        email:
          type: string
          format: email
          nullable: true
          description: User's email address
          example: "john.doe@example.com"
        full_name:
          type: string
          nullable: true
          description: User's full name
          example: "John Doe"
          minLength: 1
          maxLength: 100
        company_name:
          type: string
          nullable: true
          description: Business or company name
          example: "Acme Real Estate"
          minLength: 1
          maxLength: 100
        phone:
          type: string
          nullable: true
          description: Phone number
          example: "+1 (555) 123-4567"
          minLength: 1
          maxLength: 20
        billing_address:
          type: object
          nullable: true
          description: Structured billing address
          properties:
            line1:
              type: string
              example: "123 Main St"
            line2:
              type: string
              example: "Suite 100"
            city:
              type: string
              example: "San Francisco"
            state:
              type: string
              example: "CA"
            postal_code:
              type: string
              example: "94102"
            country:
              type: string
              example: "US"
              description: "ISO 3166-1 alpha-2 country code"
        profile_photo_url:
          type: string
          format: uri
          nullable: true
          description: URL to user's profile photo
          example: "https://example.com/photos/johndoe.jpg"
        preferences:
          type: object
          nullable: true
          description: User preferences for application behavior
          properties:
            email_notifications:
              type: boolean
              example: true
            marketing_emails:
              type: boolean
              example: false
            default_room_type:
              type: string
              example: "living_room"
              enum:
                - living_room
                - bedroom
                - kitchen
                - bathroom
                - dining_room
                - office
            default_style:
              type: string
              example: "modern"
              enum:
                - modern
                - contemporary
                - traditional
                - scandinavian
                - industrial
                - bohemian
        role:
          type: string
          description: User role
          example: "user"
          enum:
            - user
            - admin
        stripe_customer_id:
          type: string
          nullable: true
          description: Stripe customer identifier
          example: "cus_ABC123"
        created_at:
          type: string
          format: date-time
          description: Timestamp when the user was created
          example: "2025-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the user profile was last updated
          example: "2025-01-15T14:22:00Z"
    UpdateUserProfileRequest:
      type: object
      description: |
        Request body for updating user profile. All fields are optional.
        Only provided fields will be updated.
      properties:
        email:
          type: string
          format: email
          description: User's email address (3-255 characters)
          example: "newemail@example.com"
          minLength: 3
          maxLength: 255
        full_name:
          type: string
          description: User's full name (1-100 characters)
          example: "Jane Smith"
          minLength: 1
          maxLength: 100
        company_name:
          type: string
          description: Business or company name (1-100 characters)
          example: "Smith Realty"
          minLength: 1
          maxLength: 100
        phone:
          type: string
          description: Phone number (1-20 characters)
          example: "+1 (555) 987-6543"
          minLength: 1
          maxLength: 20
        billing_address:
          type: object
          description: Structured billing address
          properties:
            line1:
              type: string
              example: "456 Oak Ave"
            line2:
              type: string
              example: "Apt 5B"
            city:
              type: string
              example: "Portland"
            state:
              type: string
              example: "OR"
            postal_code:
              type: string
              example: "97201"
            country:
              type: string
              example: "US"
              description: "ISO 3166-1 alpha-2 country code"
        profile_photo_url:
          type: string
          format: uri
          description: URL to user's profile photo
          example: "https://example.com/photos/janesmith.jpg"
        preferences:
          type: object
          description: User preferences
          properties:
            email_notifications:
              type: boolean
              description: Enable email notifications for job updates
              example: true
            marketing_emails:
              type: boolean
              description: Enable marketing and promotional emails
              example: false
            default_room_type:
              type: string
              description: Default room type for new stagings
              example: "bedroom"
              enum:
                - living_room
                - bedroom
                - kitchen
                - bathroom
                - dining_room
                - office
            default_style:
              type: string
              description: Default style for new stagings
              example: "contemporary"
              enum:
                - modern
                - contemporary
                - traditional
                - scandinavian
                - industrial
                - bohemian
